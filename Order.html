<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; padding:20px; }
.item { display:flex; gap:14px; border:1px solid #ddd; padding:14px;
        border-radius:12px; margin-bottom:12px; }
.item img { width:120px; height:120px; border-radius:12px; object-fit:cover; }
.total { font-size:22px; font-weight:bold; margin-top:20px; }
input, button { width:100%; padding:14px; margin-top:12px; font-size:18px; border-radius:8px; }
button { background:black; color:white; border:0; cursor:pointer; }
</style>
</head>

<body>

<h2>Order Summary</h2>

<div id="itemsContainer"></div>

<div class="total">Estimated Total: <span id="totalPrice">0</span> ETB</div>

<h3>Your Details</h3>
<input id="name" placeholder="Full Name">
<input id="phone" placeholder="Phone Number">

<button onclick="submitOrder()">Submit Order</button>

<script>
function loadItems() {
    let single = JSON.parse(localStorage.getItem("singleProduct") || "null");
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");

    let items = [];

    // include single product if exists
    if (single) items.push(single);

    // include all cart items
    if (cart.length > 0) items = items.concat(cart);

    const box = document.getElementById("itemsContainer");

    if (items.length === 0) {
        box.innerHTML = "<p>No items found.</p>";
        return;
    }

    let total = 0;

    items.forEach(item => {
        let price = parseFloat(item.price.toString().replace(/[^\d.]/g, ""));
        total += price * item.quantity;

        box.innerHTML +=` 
        <div class="item">
            <img src="${item.image}">
            <div>
                <b>${item.name}</b><br>
                Price: ${item.price}<br>
                Size: ${item.size}<br>
                Color: ${item.color}<br>
                Qty: ${item.quantity}
            </div>
        </div>`;
    });

    document.getElementById("totalPrice").textContent = total.toLocaleString();

    localStorage.setItem("orderItems", JSON.stringify(items));
    localStorage.setItem("orderTotal", total);
}

function submitOrder() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const items = JSON.parse(localStorage.getItem("orderItems") || "[]");
    const total = localStorage.getItem("orderTotal");

    if (!name || !phone) return alert("Enter name & phone!");

    let txt = `ðŸ› NEW ORDER\n\nðŸ‘¤ Name: ${name}\nðŸ“ž Phone: ${phone}\n\n`;

    items.forEach(i => {
        txt += `ðŸ“Œ ${i.name}\n- Price: ${i.price}\n- Size: ${i.size}\n- Color: ${i.color}\n- Qty: ${i.quantity}\n\n`;
    });

    txt += `ðŸ’° TOTAL: ${total} ETB`;

    const BOT = "8458097036:AAG29CuWdhYBKspr3BS6N-yWeXkkBEVUzTo";
    const CHAT = "5335234629";

    fetch(`https://api.telegram.org/bot8458097036:AAG29CuWdhYBKspr3BS6N-yWeXkkBEVUzTo/sendMessage?chat_id=5335234629&text=${encodeURIComponent(txt)}`)
        .then(() => alert("Order Sent!"))
        .catch(() => alert("Send Failed"));
}

loadItems();
</script>

</body>
</html>